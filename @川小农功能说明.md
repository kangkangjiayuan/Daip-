# @川小农 AI大模型功能说明

## 🎯 功能概述

@川小农是四川农业大学的智能百科助手，现已成功对接AI大模型，能够回答关于四川农业大学的各类问题，为学生、家长和关心川农的人士提供准确、及时、友好的信息。

## 🛠 技术实现

### 1. AI大模型配置

- **模型名称**: Qwen2.5-7B-Instruct
- **API提供商**: SiliconFlow (https://api.siliconflow.cn/)
- **API密钥**: sk-jnmakzcrkwfvgbymzrcwurcltdcyxojmsgqrgnvnkqjrdhwh
- **Base URL**: https://api.siliconflow.cn/v1/
- **协议**: OpenAI API标准

### 2. 核心功能实现

#### 2.1 AI配置管理
```python
AI_CONFIG = {
    'api_key': 'sk-jnmakzcrkwfvgbymzrcwurcltdcyxojmsgqrgnvnkqjrdhwh',
    'model_name': 'Qwen2.5-7B-Instruct',
    'api_url': 'https://api.siliconflow.cn/v1/',
    'base_url': 'https://api.siliconflow.cn/v1/'
}
```

#### 2.2 OpenAI客户端初始化
```python
openai_client = openai.OpenAI(
    api_key=AI_CONFIG['api_key'],
    base_url=AI_CONFIG['base_url']
)
```

#### 2.3 川小农角色提示词
```python
system_prompt = """你是川小农，四川农业大学的智能百科助手。你的使命是回答关于四川农业大学的各类问题，为学生、家长和关心川农的人士提供准确、及时、友好的信息。

请始终以川小农的身份回答，保持友好、专业的语气，并确保信息的准确性。如果遇到不确定的信息，请诚实地表示不知道，并建议用户查询官方渠道获取最新信息。"""
```

### 3. 使用方式

#### 3.1 基本使用
在聊天室中输入 `@川小农` + 具体问题，AI将智能回答：

**示例输入**:
```
@川小农 四川农业大学有哪些校区？
```

**示例输出**:
```
川小农：四川农业大学现有雅安校区、成都校区和都江堰校区三个校区。

雅安校区：位于雅安市雨城区，是学校的主校区，主要承担本科教学和部分研究生培养任务。

成都校区：位于成都市温江区，主要承担研究生培养、科学研究和高水平国际合作与交流等任务。

都江堰校区：位于都江堰市，主要承担教学、科研和科技示范推广等功能。

三个校区各有特色，共同构成了完整的办学体系。
```

#### 3.2 功能特点
- ✅ **智能问答**: 基于AI大模型，理解上下文，提供准确回答
- ✅ **角色扮演**: 扮演川小农角色，保持专业友好的语气
- ✅ **知识覆盖**: 涵盖川农历史、专业、校区、学费等各类问题
- ✅ **错误处理**: AI调用失败时自动回退到知识库查询
- ✅ **中文优化**: 针对中文语境优化，回答更自然流畅

### 4. 技术架构

#### 4.1 Flask应用
- **端口**: 5001 (避免端口5000冲突)
- **框架**: Flask + Flask-SocketIO
- **实时通信**: WebSocket (SocketIO)

#### 4.2 AI调用流程
1. **消息接收**: 用户在聊天室发送 `@川小农 + 问题`
2. **命令解析**: 系统识别@川小农命令，提取问题内容
3. **AI调用**: 使用OpenAI客户端调用Qwen2.5-7B-Instruct模型
4. **响应处理**: 解析AI回复，通过SocketIO发送new_message事件
5. **错误回退**: AI调用失败时使用原有知识库系统

#### 4.3 代码结构
```
app.py (主应用文件)
├── AI_CONFIG (AI大模型配置)
├── openai_client (OpenAI客户端实例)
├── generate_ai_response() (AI响应生成函数)
├── handle_send_message() (消息处理函数)
└── @川小农命令处理逻辑
```

### 5. API接口

#### 5.1 WebSocket事件
- **send_message**: 发送消息事件
- **new_message**: 新消息接收事件
- **leave_room**: 退出聊天室事件

#### 5.2 REST API
- **GET /**: 主页面
- **GET /health**: 健康检查

### 6. 测试验证

#### 6.1 AI大模型测试
通过 `test_ai_model.py` 脚本测试：
- ✅ OpenAI客户端初始化成功
- ✅ Qwen2.5-7B-Instruct模型连接正常
- ✅ 川小农角色提示词工作正常
- ✅ 能够准确回答川农相关问题
- ✅ 响应格式完整，包含token统计信息

#### 6.2 测试结果示例
```
🔍 测试问题 1: 四川农业大学有哪些校区？
✅ AI回复: 四川农业大学现有雅安校区、成都校区和都江堰校区三个校区...

🔍 测试问题 2: 川农的校训是什么？
✅ AI回复: 川农的校训是"明德孝行，求是拓新"...

🔍 测试问题 3: 能介绍一下四川农业大学的历史吗？
✅ AI回复: 当然可以！四川农业大学的历史源远流长，它的发展历程可以追溯到1906年...

🔍 测试问题 4: 川农有哪些特色专业？
✅ AI回复: 川农作为重点农业大学，拥有多个特色专业...
```

### 7. 启动说明

#### 7.1 环境要求
- Python 3.10+
- Flask
- Flask-SocketIO
- python-socketio
- openai >= 1.0.0

#### 7.2 启动命令
```bash
python app.py
```

#### 7.3 访问地址
```
http://localhost:5001
```

### 8. 故障排除

#### 8.1 常见问题
1. **端口占用**: 使用 `taskkill /f /im python.exe` 清理端口
2. **API密钥错误**: 检查AI_CONFIG中的api_key是否正确
3. **网络连接**: 确认能够访问 https://api.siliconflow.cn/

#### 8.2 错误处理机制
- AI调用失败时自动回退到知识库
- 网络异常时提供友好错误提示
- 日志记录详细错误信息

## 🎉 功能完成状态

✅ **AI大模型对接完成** - Qwen2.5-7B-Instruct
✅ **OpenAI API标准实现** - 完整支持OpenAI格式
✅ **川小农角色设定** - 专业的农业高校助手身份
✅ **WebSocket集成** - 实时聊天消息处理
✅ **错误处理机制** - 智能回退到知识库
✅ **测试验证通过** - 多轮测试确认功能正常
✅ **部署运行成功** - Flask应用正常启动

@川小农AI大模型功能开发完成！🎊